# Fantasy Football Agent: Finding Optimal Draft Picks using a Genetic Algorithm


## Overview

Fantasy football has a massive following, with the two largest platforms being ESPN (twelve million users) and Yahoo (ten million users). 
Most users rely on little more than a gut feeling, advice from podcasts or articles, and the ADP (average draft position) provided by their respective platforms.

What is fantasy football?    
Fantasy football is a virtual game where users select a unique set of players to compete with for the entire season. To win a week in fantasy football, 
your players must score more total points than your opponent's players. Players are selected through a draft process, where a group of users takes turns picking players. 
To ensure fairness, each user is assigned a set of “draft picks” that determines the order in which players are selected 
(e.g., the user with pick one selects a player before the user with pick two). Players are assigned an ADP (average draft position), 
which reflects where in the draft a player is usually taken, to guide users on when to select certain players.

The goal of this project is to predict the strongest possible fantasy football team that a user could draft for a given season. 
To achieve this, we collected data on each player and used a genetic algorithm to analyze it. 
Teams were ranked by the total points scored by their selected players over a season. For comparison, 
we calculated the average performance of a team composed of players selected based on their ADP at the same draft positions. 

## Features

# Database Creation
- You can create the database to base the algorithm off of from these files.
- It currently is set up to create a database from 2017 - 2024.
- How to update this is laid out below.

# Webscraping For Articles
- Done through Selenium.
- How you can adjust this to reflect which dates you want to be using is detailed below.

# Genetic Algorithm
- Uses over 20 parameters to classify players.
- Keeps the best performing agent and saves to a CSV file.

# Team Output/Validation
- Can use outputted weights to draft a team
- Can also draft a team from ADP values for comparison

## Document Overview
- geneticAlgo
     - validatePackage
          - 2023_source_data_with_handled_missing_values.xlsx: Contains data for each player in the year 2023. Similar to `combined_player_data_2012_2022`.csv, but for 2023.
          - Figure_2.png: Shows players drafted by our agent and by ADP's recommendation.
          - Figure_3.png: Shows total points scored by agent's players and ADP's recommended players.
          - comparison_teams_2023_with_agentScore.xlsx: 
          - recommended_agent_weights.xlsx: Contains weights of the best agent from the genetic algorithm.
          - runWithADP.py: Same as file listed below with the same name.
          - validateAgent.py: Drafts for the agent and ADP and compares the two teams.
     - Figure_1.png: An output comparing the best possible team drafted by our agent to the best team drafted by ADP in that year.
     - code_with_dynamic_plot.py: Runs the algorithm with a visual representation of what the algorithm is doing. Required to be in a jupyter notebook for demonstration.
     - combined_player_data_2012_2022.csv: A file generated by `datainjectionfromAWS.py`.
     - datainjectionfromAWS.py: Gets all data needed for the algorithm from the database.
     - fast_graph.py: Has a function that can be used to visualize what our algorithm is doing. Uses presaved data, but you can feed it new data.
     - runWithADP.py: Our genetic algorithm. Can run using this. Adjust the file path for your own machine.
- CS5100 Project Proposal.pdf: Our original project proposal.
- Data Selection Write Up.docx: A short write up used as a basis for our data section the the final report.
- Final Project Demo - SD 480p.mov: The demo used in our presentation.
- adp_merged_7_17.csv: The csv file where we got our ADP data from.
- bertattempt.py: First attempt at using BERT to classify article positivity.
- databasebuilder.py: Creates the database for the algorithm to run off of.
- image.png: A 2023 team created by our agent.
- news_data_2024.csv: A tester file created that pulled articles.
- player_news_table.csv: Contains the articles pulled from the web scraper.
- player_news_table_with_labels.csv: Cleaned articles and scores for the articles.
- player_stats.csv: Has the game by game stats for players. Used for research but did not end up using.
- player_stats_season.csv: Has the season by season stats for players. Used for the project to get season long stats and player names.
- requirements.txt: Lists the required libraries to run the project.
- sentiment_analysis.py: Cleans the articles, and scores the articles with a positivity score using a pretrained BERT model.
- web_scrapping_rough.py: Used to scrape articles from the web.
- yearly_player_data_includes_player_info.csv: Got player health information from here.

## Getting Started
If you wish to run as is only follow steps 1 and 5. If you wish to make update for a year not between 2017-2023 steps 3, 4, 5 will walk you through how to do that.

1. Create an AWS MySQL server, and save all login information into `databasebuilder.py`. You will also need to save this information into `datainjectionFromAWS.py`.
2. You will need to replace all CSV files with CSV files containing updated data, and adjust the `databasebuilder.py` to handle the differences in these files. Adjust the function fill_database and personal_player_stats to reflect the new CSVs you will be loading in.
3. Adjust the range in the for loop on line 50 in the file `web_scrapping_rough.py`. This will change which page it goes back to. To check if a page is correct for you https://tools.thehuddle.com/nfl-fantasy-football-player-news/0/all-teams/?page=<PAGE_NUMBER> use this URL and replace PAGE_NUMBER with the page you wish to check out. I recommend putting this after an NFL draft has occurred. Usually May 2nd is safe.
4. Run both `web_scrapping_rough.py` and `sentiment_analysis.py`.
5. Run `databasebuilder.py` to create the database in your MySQL server.

### Prequisites

Have Python 3.11 installed. Create a virtual environment and load the libraries needed from `requirements.txt`. You will also need a Chromium driver in your Python path.

# Genetic Algorithm and Validation Code: Quick Start Guide

## **Guideline for Genetic Algorithm Code**
Tips: all the document are in the geneticAlgo file

### **Quick Start Steps**
1. **Get the Data**
   - Run `datainjectionFromAWS.py` to fetch the data from the AWS database.

2. **Save the Data**
   - Find a local path to store the source data.
   - Copy the path into your computer for easy reference.

3. **Run the Driver**
   - Execute `runWithADP.py`. This is the main driver for the genetic algorithm.

4. **Check the Output**
   - After running the driver, you will get the following results:
     1. **Chart**: A visual comparison between the final team and the ADP team. 
     2. **Excel File**: The final picked team with its detailed data organized by years.
     3. **Excel File**: Recommended agent with its optimized weights.
     4. **Excel File**: ADP reference team with its detailed data organized by years.

---

## **Guideline for Validation of Genetic Algorithm Code**

### **Quick Start Steps**
1. **Environment Setup**
   - Ensure the following files are in place:
     - `validateAgent.py`
     - `runWithADP.py`
     - `recommended_agent_weights.xlsx` (output from the genetic algorithm code, representing the best agent).

2. **Run the Driver**
   - Execute `validateAgent.py`. 
   - It will fetch the 2023 data from AWS and use the recommended agent to run the team-picking process.

3. **Check the Output**
   - After running the validation, you will get the following results:
     1. **Chart**: A visual comparison between the final team and the ADP team.
     2. **Chart**: A pick-by-pick comparison between the ADP team and the optimized team.
     3. **Excel File**: The 2023 source meta data for reference.
     4. **Excel File**: The final picked team for both the ADP team and the optimized team based on the best agent.


Result : ![alt text](image.png)

## Acknowledgements

### [A genetic algorithm to solve the production lot-sizing problem with capacity adjustment](https://www.sciencedirect.com/science/article/pii/S0305054824002788)

### [Draft-Kings-Genetic-Solution](https://github.com/Rogerctoussaint/Draft-Kings-Genetic-Solution), reference in drafting

### [Top-Genetic-Algorithm](https://github.com/rafa2000/Top-Genetic-Algorithm/blob/master/readme.md), Many ideas on GA
